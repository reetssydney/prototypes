/*! OOUI v0.29.5 | http://oojs.mit-license.org */
!function(d){"use strict";d.ui.mixin.DraggableElement=function(t){t=t||{},this.index=null,this.$handle=t.$handle||this.$element,this.wasHandleUsed=null,this.$element.addClass("oo-ui-draggableElement").on({mousedown:this.onDragMouseDown.bind(this),dragstart:this.onDragStart.bind(this),dragover:this.onDragOver.bind(this),dragend:this.onDragEnd.bind(this),drop:this.onDrop.bind(this)}),this.$handle.addClass("oo-ui-draggableElement-handle"),this.toggleDraggable(void 0===t.draggable||!!t.draggable)},d.initClass(d.ui.mixin.DraggableElement),d.ui.mixin.DraggableElement.static.cancelButtonMouseDownEvents=!1,d.ui.mixin.DraggableElement.prototype.toggleDraggable=function(t){t=void 0!==t?!!t:!this.draggable,this.draggable!==t&&(this.draggable=t,this.$handle.toggleClass("oo-ui-draggableElement-undraggable",!this.draggable),this.$element.prop("draggable",this.draggable))},d.ui.mixin.DraggableElement.prototype.isDraggable=function(){return this.draggable},d.ui.mixin.DraggableElement.prototype.onDragMouseDown=function(t){this.isDraggable()&&(this.wasHandleUsed=this.$handle[0]===this.$element[0]||d.ui.contains(this.$handle[0],t.target,!0))},d.ui.mixin.DraggableElement.prototype.onDragStart=function(t){var e=this,i=t.originalEvent.dataTransfer;if(!this.wasHandleUsed||!this.isDraggable())return!1;i.dropEffect="none",i.effectAllowed="move";try{i.setData("application-x/OOUI-draggable",this.getIndex())}catch(t){}return this.$element.addClass("oo-ui-draggableElement-clone"),setTimeout(function(){e.$element.removeClass("oo-ui-draggableElement-clone").addClass("oo-ui-draggableElement-placeholder")}),this.emit("dragstart",this),!0},d.ui.mixin.DraggableElement.prototype.onDragEnd=function(){this.$element.removeClass("oo-ui-draggableElement-placeholder"),this.emit("dragend")},d.ui.mixin.DraggableElement.prototype.onDrop=function(t){t.preventDefault(),this.emit("drop",t)},d.ui.mixin.DraggableElement.prototype.onDragOver=function(t){t.preventDefault()},d.ui.mixin.DraggableElement.prototype.setIndex=function(t){this.index!==t&&(this.index=t,this.$element.data("index",t))},d.ui.mixin.DraggableElement.prototype.getIndex=function(){return this.index},d.ui.mixin.DraggableGroupElement=function(t){t=t||{},d.ui.mixin.GroupElement.call(this,t),this.orientation=t.orientation||"vertical",this.dragItem=null,this.itemKeys={},this.dir=null,this.itemsOrder=null,this.draggable=void 0===t.draggable||!!t.draggable,this.aggregate({dragstart:"itemDragStart",dragend:"itemDragEnd",drop:"itemDrop"}),this.connect(this,{itemDragStart:"onItemDragStart",itemDrop:"onItemDropOrDragEnd",itemDragEnd:"onItemDropOrDragEnd"}),Array.isArray(t.items)&&this.addItems(t.items),this.$element.addClass("oo-ui-draggableGroupElement").toggleClass("oo-ui-draggableGroupElement-horizontal","horizontal"===this.orientation)},d.mixinClass(d.ui.mixin.DraggableGroupElement,d.ui.mixin.GroupElement),d.ui.mixin.DraggableGroupElement.prototype.toggleDraggable=function(t){t=void 0!==t?!!t:!this.draggable,this.draggable!==t&&(this.draggable=t,this.getItems().forEach(function(t){t.toggleDraggable(this.draggable)}.bind(this)),this.emit("draggable",this.draggable))},d.ui.mixin.DraggableGroupElement.prototype.isDraggable=function(){return this.draggable},d.ui.mixin.DraggableGroupElement.prototype.onItemDragStart=function(t){this.isDraggable()&&(this.itemsOrder=this.items.slice(),this.updateIndexes(),"horizontal"===this.orientation&&(this.dir=this.$element.css("direction")),this.setDragItem(t))},d.ui.mixin.DraggableGroupElement.prototype.updateIndexes=function(){var t,e;for(t=0,e=this.itemsOrder.length;t<e;t++)this.itemsOrder[t].setIndex(t)},d.ui.mixin.DraggableGroupElement.prototype.onItemDropOrDragEnd=function(){var t,e,i=this.getDragItem();return i&&(e=this.items.indexOf(i),(t=i.getIndex()+(i.getIndex()>e?1:0))!==e&&(this.reorder(this.getDragItem(),t),this.emit("reorder",this.getDragItem(),t)),this.updateIndexes()),this.unsetDragItem(),!1},d.ui.mixin.DraggableGroupElement.prototype.onDragOver=function(t){var e,i,n=this.getDragItem(),s=n.getIndex();void 0!==(e=$(t.target).closest(".oo-ui-draggableElement").data("index"))&&e!==s&&(0<(i=e+(s<e?1:0))?this.$group.children().eq(i-1).after(n.$element):this.$group.prepend(n.$element),this.itemsOrder.splice(e,0,this.itemsOrder.splice(s,1)[0]),this.updateIndexes(),this.emit("drag",n,i)),t.preventDefault()},d.ui.mixin.DraggableGroupElement.prototype.reorder=function(t,e){this.addItems([t],e)},d.ui.mixin.DraggableGroupElement.prototype.setDragItem=function(t){this.dragItem!==t&&(this.dragItem=t,this.$element.on("dragover",this.onDragOver.bind(this)),this.$element.addClass("oo-ui-draggableGroupElement-dragging"))},d.ui.mixin.DraggableGroupElement.prototype.unsetDragItem=function(){this.dragItem&&(this.dragItem=null,this.$element.off("dragover"),this.$element.removeClass("oo-ui-draggableGroupElement-dragging"))},d.ui.mixin.DraggableGroupElement.prototype.getDragItem=function(){return this.dragItem},d.ui.mixin.RequestManager=function(){this.requestCache={},this.requestQuery=null,this.requestRequest=null},d.initClass(d.ui.mixin.RequestManager),d.ui.mixin.RequestManager.prototype.getRequestData=function(){var e,i=this,n=this.getRequestQuery(),s=$.Deferred();return this.abortRequest(),Object.prototype.hasOwnProperty.call(this.requestCache,n)?s.resolve(this.requestCache[n]):(this.pushPending&&this.pushPending(),this.requestQuery=n,(e=this.requestRequest=this.getRequest()).always(function(){i.popPending&&i.popPending()}).done(function(t){e===i.requestRequest&&(i.requestQuery=null,i.requestRequest=null,i.requestCache[n]=i.getRequestCacheDataFromResponse(t),s.resolve(i.requestCache[n]))}).fail(function(){e===i.requestRequest&&(i.requestQuery=null,i.requestRequest=null,s.reject())})),s.promise()},d.ui.mixin.RequestManager.prototype.abortRequest=function(){var t=this.requestRequest;t&&(this.requestRequest=null,this.requestQuery=null,t.abort())},d.ui.mixin.RequestManager.prototype.getRequestQuery=null,d.ui.mixin.RequestManager.prototype.getRequest=null,d.ui.mixin.RequestManager.prototype.getRequestCacheDataFromResponse=null,d.ui.mixin.LookupElement=function(t){t=$.extend({highlightFirst:!0},t),d.ui.mixin.RequestManager.call(this,t),this.$overlay=(!0===t.$overlay?d.ui.getDefaultOverlay():t.$overlay)||this.$element,this.lookupMenu=new d.ui.MenuSelectWidget($.extend({widget:this,input:this,$floatableContainer:t.$container||this.$element},t.menu)),this.allowSuggestionsWhenEmpty=t.allowSuggestionsWhenEmpty||!1,this.lookupsDisabled=!1,this.lookupInputFocused=!1,this.lookupHighlightFirstItem=t.highlightFirst,this.$input.on({focus:this.onLookupInputFocus.bind(this),blur:this.onLookupInputBlur.bind(this),mousedown:this.onLookupInputMouseDown.bind(this)}),this.connect(this,{change:"onLookupInputChange"}),this.lookupMenu.connect(this,{toggle:"onLookupMenuToggle",choose:"onLookupMenuItemChoose"}),this.$input.attr({role:"combobox","aria-owns":this.lookupMenu.getElementId(),"aria-autocomplete":"list"}),this.$element.addClass("oo-ui-lookupElement"),this.lookupMenu.$element.addClass("oo-ui-lookupElement-menu"),this.$overlay.append(this.lookupMenu.$element)},d.mixinClass(d.ui.mixin.LookupElement,d.ui.mixin.RequestManager),d.ui.mixin.LookupElement.prototype.onLookupInputFocus=function(){this.lookupInputFocused=!0,this.populateLookupMenu()},d.ui.mixin.LookupElement.prototype.onLookupInputBlur=function(){this.closeLookupMenu(),this.lookupInputFocused=!1},d.ui.mixin.LookupElement.prototype.onLookupInputMouseDown=function(){this.lookupInputFocused&&!this.lookupMenu.isVisible()&&this.populateLookupMenu()},d.ui.mixin.LookupElement.prototype.onLookupInputChange=function(){this.lookupInputFocused&&this.populateLookupMenu()},d.ui.mixin.LookupElement.prototype.onLookupMenuToggle=function(t){t||(this.abortLookupRequest(),this.lookupMenu.clearItems())},d.ui.mixin.LookupElement.prototype.onLookupMenuItemChoose=function(t){this.setValue(t.getData())},d.ui.mixin.LookupElement.prototype.getLookupMenu=function(){return this.lookupMenu},d.ui.mixin.LookupElement.prototype.setLookupsDisabled=function(t){this.lookupsDisabled=!!t},d.ui.mixin.LookupElement.prototype.openLookupMenu=function(){return this.lookupMenu.isEmpty()||this.lookupMenu.toggle(!0),this},d.ui.mixin.LookupElement.prototype.closeLookupMenu=function(){return this.lookupMenu.toggle(!1),this.abortLookupRequest(),this.lookupMenu.clearItems(),this},d.ui.mixin.LookupElement.prototype.populateLookupMenu=function(){var e=this,t=this.getValue();if(!this.lookupsDisabled&&!this.isReadOnly())return this.allowSuggestionsWhenEmpty||""!==t?t!==this.lookupQuery&&this.getLookupMenuItems().done(function(t){e.lookupMenu.clearItems(),t.length?(e.lookupMenu.addItems(t).toggle(!0),e.initializeLookupMenuSelection()):e.lookupMenu.toggle(!1)}).fail(function(){e.lookupMenu.clearItems(),e.lookupMenu.toggle(!1)}):this.closeLookupMenu(),this},d.ui.mixin.LookupElement.prototype.initializeLookupMenuSelection=function(){this.lookupHighlightFirstItem&&!this.lookupMenu.findSelectedItem()&&this.lookupMenu.highlightItem(this.lookupMenu.findFirstSelectableItem())},d.ui.mixin.LookupElement.prototype.getLookupMenuItems=function(){return this.getRequestData().then(function(t){return this.getLookupMenuOptionsFromData(t)}.bind(this))},d.ui.mixin.LookupElement.prototype.abortLookupRequest=function(){this.abortRequest()},d.ui.mixin.LookupElement.prototype.getLookupRequest=null,d.ui.mixin.LookupElement.prototype.getLookupCacheDataFromResponse=null,d.ui.mixin.LookupElement.prototype.getLookupMenuOptionsFromData=null,d.ui.mixin.LookupElement.prototype.setReadOnly=function(t){return d.ui.TextInputWidget.prototype.setReadOnly.call(this,t),this.isReadOnly()&&this.lookupMenu&&this.closeLookupMenu(),this},d.ui.mixin.LookupElement.prototype.getRequestQuery=function(){return this.getValue()},d.ui.mixin.LookupElement.prototype.getRequest=function(){return this.getLookupRequest()},d.ui.mixin.LookupElement.prototype.getRequestCacheDataFromResponse=function(t){return this.getLookupCacheDataFromResponse(t)},d.ui.TabPanelLayout=function(t,e){d.isPlainObject(t)&&void 0===e&&(t=(e=t).name),e=$.extend({scrollable:!0},e),d.ui.TabPanelLayout.parent.call(this,e),this.name=t,this.label=e.label,this.tabItem=null,this.active=!1,this.$element.addClass("oo-ui-tabPanelLayout").attr("role","tabpanel")},d.inheritClass(d.ui.TabPanelLayout,d.ui.PanelLayout),d.ui.TabPanelLayout.prototype.getName=function(){return this.name},d.ui.TabPanelLayout.prototype.isActive=function(){return this.active},d.ui.TabPanelLayout.prototype.getTabItem=function(){return this.tabItem},d.ui.TabPanelLayout.prototype.setTabItem=function(t){return this.tabItem=t||null,t&&this.setupTabItem(),this},d.ui.TabPanelLayout.prototype.setupTabItem=function(){return this.$element.attr("aria-labelledby",this.tabItem.getElementId()),this.tabItem.$element.attr("aria-controls",this.getElementId()),this.label&&this.tabItem.setLabel(this.label),this},d.ui.TabPanelLayout.prototype.setActive=function(t){(t=!!t)!==this.active&&(this.active=t,this.$element.toggleClass("oo-ui-tabPanelLayout-active",this.active),this.emit("active",this.active))},d.ui.PageLayout=function(t,e){d.isPlainObject(t)&&void 0===e&&(t=(e=t).name),e=$.extend({scrollable:!0},e),d.ui.PageLayout.parent.call(this,e),this.name=t,this.outlineItem=null,this.active=!1,this.$element.addClass("oo-ui-pageLayout")},d.inheritClass(d.ui.PageLayout,d.ui.PanelLayout),d.ui.PageLayout.prototype.getName=function(){return this.name},d.ui.PageLayout.prototype.isActive=function(){return this.active},d.ui.PageLayout.prototype.getOutlineItem=function(){return this.outlineItem},d.ui.PageLayout.prototype.setOutlineItem=function(t){return this.outlineItem=t||null,t&&this.setupOutlineItem(),this},d.ui.PageLayout.prototype.setupOutlineItem=function(){return this},d.ui.PageLayout.prototype.setActive=function(t){(t=!!t)!==this.active&&(this.active=t,this.$element.toggleClass("oo-ui-pageLayout-active",t),this.emit("active",this.active))},d.ui.StackLayout=function(t){t=$.extend({scrollable:!0},t),d.ui.StackLayout.parent.call(this,t),d.ui.mixin.GroupElement.call(this,$.extend({},t,{$group:this.$element})),this.currentItem=null,this.continuous=!!t.continuous,this.$element.addClass("oo-ui-stackLayout"),this.continuous&&(this.$element.addClass("oo-ui-stackLayout-continuous"),this.$element.on("scroll",d.ui.debounce(this.onScroll.bind(this),250))),Array.isArray(t.items)&&this.addItems(t.items)},d.inheritClass(d.ui.StackLayout,d.ui.PanelLayout),d.mixinClass(d.ui.StackLayout,d.ui.mixin.GroupElement),d.ui.StackLayout.prototype.onScroll=function(){var t,e=this.items.length,i=this.items.indexOf(this.currentItem),n=i,s=this.$element[0].getBoundingClientRect();if(s&&(s.top||s.bottom)){if((t=o(this.currentItem)).bottom<s.top)for(;++n<e&&!u(this.items[n]););else if(t.top>s.bottom)for(;0<=--n&&!u(this.items[n]););n!==i&&this.emit("visibleItemChange",this.items[n])}function o(t){return t.$element[0].getBoundingClientRect()}function u(t){var e=o(t);return e.bottom>s.top&&e.top<s.bottom}},d.ui.StackLayout.prototype.getCurrentItem=function(){return this.currentItem},d.ui.StackLayout.prototype.unsetCurrentItem=function(){null!==this.currentItem&&(this.currentItem=null,this.emit("set",null))},d.ui.StackLayout.prototype.addItems=function(t,e){return this.updateHiddenState(t,this.currentItem),d.ui.mixin.GroupElement.prototype.addItems.call(this,t,e),!this.currentItem&&t.length&&this.setItem(t[0]),this},d.ui.StackLayout.prototype.removeItems=function(t){return d.ui.mixin.GroupElement.prototype.removeItems.call(this,t),-1!==t.indexOf(this.currentItem)&&(this.items.length?this.setItem(this.items[0]):this.unsetCurrentItem()),this},d.ui.StackLayout.prototype.clearItems=function(){return this.unsetCurrentItem(),d.ui.mixin.GroupElement.prototype.clearItems.call(this),this},d.ui.StackLayout.prototype.setItem=function(t){return t!==this.currentItem&&(this.updateHiddenState(this.items,t),-1!==this.items.indexOf(t)?(this.currentItem=t,this.emit("set",t)):this.unsetCurrentItem()),this},d.ui.StackLayout.prototype.resetScroll=function(){return this.continuous?d.ui.StackLayout.parent.prototype.resetScroll.call(this):(this.getItems().forEach(function(t){var e=t.$element.hasClass("oo-ui-element-hidden");t.$element.removeClass("oo-ui-element-hidden"),t.resetScroll(),e&&t.$element.addClass("oo-ui-element-hidden")}),this)},d.ui.StackLayout.prototype.updateHiddenState=function(t,e){var i,n;if(!this.continuous){for(i=0,n=t.length;i<n;i++)e&&e===t[i]||(t[i].$element.addClass("oo-ui-element-hidden"),t[i].$element.attr("aria-hidden","true"));e&&(e.$element.removeClass("oo-ui-element-hidden"),e.$element.removeAttr("aria-hidden"))}},d.ui.MenuLayout=function(t){t=$.extend({expanded:!0,showMenu:!0,menuPosition:"before"},t),d.ui.MenuLayout.parent.call(this,t),this.menuPanel=null,this.contentPanel=null,this.expanded=!!t.expanded,this.$menu=$("<div>"),this.$content=$("<div>"),this.$menu.addClass("oo-ui-menuLayout-menu"),this.$content.addClass("oo-ui-menuLayout-content"),this.$element.addClass("oo-ui-menuLayout"),t.expanded?this.$element.addClass("oo-ui-menuLayout-expanded"):this.$element.addClass("oo-ui-menuLayout-static"),t.menuPanel&&this.setMenuPanel(t.menuPanel),t.contentPanel&&this.setContentPanel(t.contentPanel),this.setMenuPosition(t.menuPosition),this.toggleMenu(t.showMenu)},d.inheritClass(d.ui.MenuLayout,d.ui.Layout),d.ui.MenuLayout.prototype.toggleMenu=function(t){return t=void 0===t?!this.showMenu:!!t,this.showMenu!==t&&(this.showMenu=t,this.$element.toggleClass("oo-ui-menuLayout-showMenu",this.showMenu).toggleClass("oo-ui-menuLayout-hideMenu",!this.showMenu),this.$menu.attr("aria-hidden",this.showMenu?"false":"true")),this},d.ui.MenuLayout.prototype.isMenuVisible=function(){return this.showMenu},d.ui.MenuLayout.prototype.setMenuPosition=function(t){return this.$element.removeClass("oo-ui-menuLayout-"+this.menuPosition),this.menuPosition=t,"top"===this.menuPosition||"before"===this.menuPosition?this.$element.append(this.$menu,this.$content):this.$element.append(this.$content,this.$menu),this.$element.addClass("oo-ui-menuLayout-"+t),this},d.ui.MenuLayout.prototype.getMenuPosition=function(){return this.menuPosition},d.ui.MenuLayout.prototype.setMenuPanel=function(t){this.menuPanel=t,this.$menu.append(this.menuPanel.$element)},d.ui.MenuLayout.prototype.setContentPanel=function(t){this.contentPanel=t,this.$content.append(this.contentPanel.$element)},d.ui.MenuLayout.prototype.clearMenuPanel=function(){this.menuPanel=null,this.$menu.empty()},d.ui.MenuLayout.prototype.clearContentPanel=function(){this.contentPanel=null,this.$content.empty()},d.ui.MenuLayout.prototype.resetScroll=function(){return this.menuPanel&&this.menuPanel.resetScroll(),this.contentPanel&&this.contentPanel.resetScroll(),this},d.ui.BookletLayout=function(t){t=t||{},d.ui.BookletLayout.parent.call(this,t),this.currentPageName=null,this.pages={},this.ignoreFocus=!1,this.stackLayout=new d.ui.StackLayout({continuous:!!t.continuous,expanded:this.expanded}),this.setContentPanel(this.stackLayout),this.autoFocus=void 0===t.autoFocus||!!t.autoFocus,this.outlineVisible=!1,this.outlined=!!t.outlined,this.outlined&&(this.editable=!!t.editable,this.outlineControlsWidget=null,this.outlineSelectWidget=new d.ui.OutlineSelectWidget,this.outlinePanel=new d.ui.PanelLayout({expanded:this.expanded,scrollable:!0}),this.setMenuPanel(this.outlinePanel),this.outlineVisible=!0,this.editable&&(this.outlineControlsWidget=new d.ui.OutlineControlsWidget(this.outlineSelectWidget))),this.toggleMenu(this.outlined),this.stackLayout.connect(this,{set:"onStackLayoutSet"}),this.outlined&&(this.outlineSelectWidget.connect(this,{select:"onOutlineSelectWidgetSelect"}),this.scrolling=!1,this.stackLayout.connect(this,{visibleItemChange:"onStackLayoutVisibleItemChange"})),this.autoFocus&&this.stackLayout.$element.on("focusin",this.onStackLayoutFocus.bind(this)),this.$element.addClass("oo-ui-bookletLayout"),this.stackLayout.$element.addClass("oo-ui-bookletLayout-stackLayout"),this.outlined&&(this.outlinePanel.$element.addClass("oo-ui-bookletLayout-outlinePanel").append(this.outlineSelectWidget.$element),this.editable&&this.outlinePanel.$element.addClass("oo-ui-bookletLayout-outlinePanel-editable").append(this.outlineControlsWidget.$element))},d.inheritClass(d.ui.BookletLayout,d.ui.MenuLayout),d.ui.BookletLayout.prototype.onStackLayoutFocus=function(t){var e,i;for(e in i=$(t.target).closest(".oo-ui-pageLayout"),this.pages)if(this.pages[e].$element[0]===i[0]&&e!==this.currentPageName){this.setPage(e);break}},d.ui.BookletLayout.prototype.onStackLayoutVisibleItemChange=function(t){this.scrolling=!0,this.outlineSelectWidget.selectItemByData(t.getName()),this.scrolling=!1},d.ui.BookletLayout.prototype.onStackLayoutSet=function(t){var e,i=this;t&&(e=this.stackLayout.continuous&&!this.scrolling?t.scrollElementIntoView():$.Deferred().resolve(),!this.autoFocus||d.ui.isMobile()||this.scrolling||e.done(function(){i.focus()}))},d.ui.BookletLayout.prototype.focus=function(t){var e,i=this.stackLayout.getItems();!(e=void 0!==t&&i[t]?i[t]:this.stackLayout.getCurrentItem())&&this.outlined&&(this.selectFirstSelectablePage(),e=this.stackLayout.getCurrentItem()),e&&(d.ui.contains(e.$element[0],this.getElementDocument().activeElement,!0)||e.focus())},d.ui.BookletLayout.prototype.focusFirstFocusable=function(){d.ui.findFocusable(this.stackLayout.$element).focus()},d.ui.BookletLayout.prototype.onOutlineSelectWidgetSelect=function(t){t&&this.setPage(t.getData())},d.ui.BookletLayout.prototype.isOutlined=function(){return this.outlined},d.ui.BookletLayout.prototype.isEditable=function(){return this.editable},d.ui.BookletLayout.prototype.isOutlineVisible=function(){return this.outlined&&this.outlineVisible},d.ui.BookletLayout.prototype.toggleOutline=function(t){var e=this;return this.outlined&&(t=void 0===t?!this.outlineVisible:!!t,this.outlineVisible=t,this.toggleMenu(t),t&&this.editable&&setTimeout(function(){d.ui.Element.static.reconsiderScrollbars(e.outlinePanel.$element[0])},200)),this},d.ui.BookletLayout.prototype.findClosestPage=function(t){var e,i,n,s=this.stackLayout.getItems(),o=s.indexOf(t);if(-1!==o&&(e=s[o+1],i=s[o-1],this.outlined)){if(n=this.outlineSelectWidget.findItemFromData(t.getName()).getLevel(),i&&n===this.outlineSelectWidget.findItemFromData(i.getName()).getLevel())return i;if(e&&n===this.outlineSelectWidget.findItemFromData(e.getName()).getLevel())return e}return i||e||null},d.ui.BookletLayout.prototype.getOutline=function(){return this.outlineSelectWidget},d.ui.BookletLayout.prototype.getOutlineControls=function(){return this.outlineControlsWidget},d.ui.BookletLayout.prototype.getPage=function(t){return this.pages[t]},d.ui.BookletLayout.prototype.getCurrentPage=function(){var t=this.getCurrentPageName();return t?this.getPage(t):void 0},d.ui.BookletLayout.prototype.getCurrentPageName=function(){return this.currentPageName},d.ui.BookletLayout.prototype.addPages=function(t,e){var i,n,s,o,u,l,a=this.stackLayout.getItems(),r=[],h=[];for(i=0,n=t.length;i<n;i++)s=(o=t[i]).getName(),Object.prototype.hasOwnProperty.call(this.pages,s)&&(-1!==(l=a.indexOf(this.pages[s]))&&l+1<e&&e--,r.push(this.pages[s]));for(r.length&&this.removePages(r),i=0,n=t.length;i<n;i++)s=(o=t[i]).getName(),this.pages[o.getName()]=o,this.outlined&&(u=new d.ui.OutlineOptionWidget({data:s}),o.setOutlineItem(u),h.push(u));return this.outlined&&h.length&&(this.outlineSelectWidget.addItems(h,e),this.selectFirstSelectablePage()),this.stackLayout.addItems(t,e),this.emit("add",t,e),this},d.ui.BookletLayout.prototype.removePages=function(t){var e,i,n,s,o=[];for(e=0,i=t.length;e<i;e++)n=(s=t[e]).getName(),delete this.pages[n],this.outlined&&(o.push(this.outlineSelectWidget.findItemFromData(n)),s.setOutlineItem(null));return this.outlined&&o.length&&(this.outlineSelectWidget.removeItems(o),this.selectFirstSelectablePage()),this.stackLayout.removeItems(t),this.emit("remove",t),this},d.ui.BookletLayout.prototype.clearPages=function(){var t,e,i=this.stackLayout.getItems();if(this.pages={},this.currentPageName=null,this.outlined)for(this.outlineSelectWidget.clearItems(),t=0,e=i.length;t<e;t++)i[t].setOutlineItem(null);return this.stackLayout.clearItems(),this.emit("remove",i),this},d.ui.BookletLayout.prototype.setPage=function(t){var e,i,n=this.pages[t],s=this.currentPageName&&this.pages[this.currentPageName];t!==this.currentPageName&&(this.outlined&&(e=this.outlineSelectWidget.findSelectedItem())&&e.getData()!==t&&this.outlineSelectWidget.selectItemByData(t),n&&(s&&(s.setActive(!1),this.autoFocus&&!d.ui.isMobile()&&this.stackLayout.continuous&&0!==d.ui.findFocusable(n.$element).length&&(i=s.$element.find(":focus")).length&&i[0].blur()),this.currentPageName=t,n.setActive(!0),this.stackLayout.setItem(n),!this.stackLayout.continuous&&s&&(i=s.$element.find(":focus")).length&&i[0].blur(),this.emit("set",n)))},d.ui.BookletLayout.prototype.resetScroll=function(){return d.ui.BookletLayout.parent.prototype.resetScroll.call(this),this.outlined&&this.stackLayout.continuous&&this.outlineSelectWidget.findFirstSelectableItem()&&(this.scrolling=!0,this.outlineSelectWidget.selectItem(this.outlineSelectWidget.findFirstSelectableItem()),this.scrolling=!1),this},d.ui.BookletLayout.prototype.selectFirstSelectablePage=function(){return this.outlineSelectWidget.findSelectedItem()||this.outlineSelectWidget.selectItem(this.outlineSelectWidget.findFirstSelectableItem()),this},d.ui.IndexLayout=function(t){t=$.extend({},t,{menuPosition:"top"}),d.ui.IndexLayout.parent.call(this,t),this.currentTabPanelName=null,this.tabPanels={},this.ignoreFocus=!1,this.stackLayout=new d.ui.StackLayout({continuous:!!t.continuous,expanded:this.expanded}),this.setContentPanel(this.stackLayout),this.autoFocus=void 0===t.autoFocus||!!t.autoFocus,this.tabSelectWidget=new d.ui.TabSelectWidget,this.tabPanel=new d.ui.PanelLayout({expanded:this.expanded}),this.setMenuPanel(this.tabPanel),this.toggleMenu(!0),this.stackLayout.connect(this,{set:"onStackLayoutSet"}),this.tabSelectWidget.connect(this,{select:"onTabSelectWidgetSelect"}),this.autoFocus&&this.stackLayout.$element.on("focusin",this.onStackLayoutFocus.bind(this)),this.$element.addClass("oo-ui-indexLayout"),this.stackLayout.$element.addClass("oo-ui-indexLayout-stackLayout"),this.tabPanel.$element.addClass("oo-ui-indexLayout-tabPanel").append(this.tabSelectWidget.$element)},d.inheritClass(d.ui.IndexLayout,d.ui.MenuLayout),d.ui.IndexLayout.prototype.onStackLayoutFocus=function(t){var e,i;for(e in i=$(t.target).closest(".oo-ui-tabPanelLayout"),this.tabPanels)if(this.tabPanels[e].$element[0]===i[0]&&e!==this.currentTabPanelName){this.setTabPanel(e);break}},d.ui.IndexLayout.prototype.onStackLayoutSet=function(t){t&&this.autoFocus&&!d.ui.isMobile()&&this.focus()},d.ui.IndexLayout.prototype.focus=function(t){var e,i=this.stackLayout.getItems();(e=void 0!==t&&i[t]?i[t]:this.stackLayout.getCurrentItem())||(this.selectFirstSelectableTabPanel(),e=this.stackLayout.getCurrentItem()),e&&(d.ui.contains(e.$element[0],this.getElementDocument().activeElement,!0)||e.focus())},d.ui.IndexLayout.prototype.focusFirstFocusable=function(){d.ui.findFocusable(this.stackLayout.$element).focus()},d.ui.IndexLayout.prototype.onTabSelectWidgetSelect=function(t){t&&this.setTabPanel(t.getData())},d.ui.IndexLayout.prototype.getClosestTabPanel=function(t){var e,i,n,s=this.stackLayout.getItems(),o=s.indexOf(t);if(-1!==o){if(e=s[o+1],i=s[o-1],n=this.tabSelectWidget.findItemFromData(t.getName()).getLevel(),i&&n===this.tabSelectWidget.findItemFromData(i.getName()).getLevel())return i;if(e&&n===this.tabSelectWidget.findItemFromData(e.getName()).getLevel())return e}return i||e||null},d.ui.IndexLayout.prototype.getTabs=function(){return this.tabSelectWidget},d.ui.IndexLayout.prototype.getTabPanel=function(t){return this.tabPanels[t]},d.ui.IndexLayout.prototype.getCurrentTabPanel=function(){var t=this.getCurrentTabPanelName();return t?this.getTabPanel(t):void 0},d.ui.IndexLayout.prototype.getCurrentTabPanelName=function(){return this.currentTabPanelName},d.ui.IndexLayout.prototype.addTabPanels=function(t,e){var i,n,s,o,u,l,a=this.stackLayout.getItems(),r=[],h=[];for(i=0,n=t.length;i<n;i++)s=(o=t[i]).getName(),Object.prototype.hasOwnProperty.call(this.tabPanels,s)&&(-1!==(l=a.indexOf(this.tabPanels[s]))&&l+1<e&&e--,r.push(this.tabPanels[s]));for(r.length&&this.removeTabPanels(r),i=0,n=t.length;i<n;i++)s=(o=t[i]).getName(),this.tabPanels[o.getName()]=o,u=new d.ui.TabOptionWidget({data:s}),o.setTabItem(u),h.push(u);return h.length&&(this.tabSelectWidget.addItems(h,e),this.selectFirstSelectableTabPanel()),this.stackLayout.addItems(t,e),this.emit("add",t,e),this},d.ui.IndexLayout.prototype.removeTabPanels=function(t){var e,i,n,s,o=[];for(e=0,i=t.length;e<i;e++)n=(s=t[e]).getName(),delete this.tabPanels[n],o.push(this.tabSelectWidget.findItemFromData(n)),s.setTabItem(null);return o.length&&(this.tabSelectWidget.removeItems(o),this.selectFirstSelectableTabPanel()),this.stackLayout.removeItems(t),this.emit("remove",t),this},d.ui.IndexLayout.prototype.clearTabPanels=function(){var t,e,i=this.stackLayout.getItems();for(this.tabPanels={},this.currentTabPanelName=null,this.tabSelectWidget.clearItems(),t=0,e=i.length;t<e;t++)i[t].setTabItem(null);return this.stackLayout.clearItems(),this.emit("remove",i),this},d.ui.IndexLayout.prototype.setTabPanel=function(t){var e,i,n,s=this.tabPanels[t];t!==this.currentTabPanelName&&(n=this.getCurrentTabPanel(),(e=this.tabSelectWidget.findSelectedItem())&&e.getData()!==t&&this.tabSelectWidget.selectItemByData(t),s&&(n&&(n.setActive(!1),this.autoFocus&&!d.ui.isMobile()&&this.stackLayout.continuous&&0!==d.ui.findFocusable(s.$element).length&&(i=n.$element.find(":focus")).length&&i[0].blur()),this.currentTabPanelName=t,s.setActive(!0),this.stackLayout.setItem(s),!this.stackLayout.continuous&&n&&(i=n.$element.find(":focus")).length&&i[0].blur(),this.emit("set",s)))},d.ui.IndexLayout.prototype.selectFirstSelectableTabPanel=function(){return this.tabSelectWidget.findSelectedItem()||this.tabSelectWidget.selectItem(this.tabSelectWidget.findFirstSelectableItem()),this},d.ui.ToggleWidget=function(t){t=t||{},d.ui.ToggleWidget.parent.call(this,t),this.value=null,this.$element.addClass("oo-ui-toggleWidget"),this.setValue(!!t.value)},d.inheritClass(d.ui.ToggleWidget,d.ui.Widget),d.ui.ToggleWidget.prototype.getValue=function(){return this.value},d.ui.ToggleWidget.prototype.setValue=function(t){return t=!!t,this.value!==t&&(this.value=t,this.emit("change",t),this.$element.toggleClass("oo-ui-toggleWidget-on",t),this.$element.toggleClass("oo-ui-toggleWidget-off",!t)),this},d.ui.ToggleButtonWidget=function(t){t=t||{},d.ui.ToggleButtonWidget.parent.call(this,t),d.ui.mixin.ButtonElement.call(this,$.extend({},t,{active:this.active})),d.ui.mixin.IconElement.call(this,t),d.ui.mixin.IndicatorElement.call(this,t),d.ui.mixin.LabelElement.call(this,t),d.ui.mixin.TitledElement.call(this,$.extend({},t,{$titled:this.$button})),d.ui.mixin.FlaggedElement.call(this,t),d.ui.mixin.TabIndexedElement.call(this,$.extend({},t,{$tabIndexed:this.$button})),this.connect(this,{click:"onAction"}),this.$button.append(this.$icon,this.$label,this.$indicator),this.$element.addClass("oo-ui-toggleButtonWidget").append(this.$button)},d.inheritClass(d.ui.ToggleButtonWidget,d.ui.ToggleWidget),d.mixinClass(d.ui.ToggleButtonWidget,d.ui.mixin.ButtonElement),d.mixinClass(d.ui.ToggleButtonWidget,d.ui.mixin.IconElement),d.mixinClass(d.ui.ToggleButtonWidget,d.ui.mixin.IndicatorElement),d.mixinClass(d.ui.ToggleButtonWidget,d.ui.mixin.LabelElement),d.mixinClass(d.ui.ToggleButtonWidget,d.ui.mixin.TitledElement),d.mixinClass(d.ui.ToggleButtonWidget,d.ui.mixin.FlaggedElement),d.mixinClass(d.ui.ToggleButtonWidget,d.ui.mixin.TabIndexedElement),d.ui.ToggleButtonWidget.static.tagName="span",d.ui.ToggleButtonWidget.prototype.onAction=function(){this.setValue(!this.value)},d.ui.ToggleButtonWidget.prototype.setValue=function(t){return(t=!!t)!==this.value&&(this.$button&&this.$button.attr("aria-pressed",t.toString()),this.setActive(t)),d.ui.ToggleButtonWidget.parent.prototype.setValue.call(this,t),this},d.ui.ToggleButtonWidget.prototype.setButtonElement=function(t){this.$button&&this.$button.removeAttr("aria-pressed"),d.ui.mixin.ButtonElement.prototype.setButtonElement.call(this,t),this.$button.attr("aria-pressed",this.value.toString())},d.ui.ToggleSwitchWidget=function(t){d.ui.ToggleSwitchWidget.parent.call(this,t),d.ui.mixin.TabIndexedElement.call(this,t),this.dragging=!1,this.dragStart=null,this.sliding=!1,this.$glow=$("<span>"),this.$grip=$("<span>"),this.$element.on({click:this.onClick.bind(this),keypress:this.onKeyPress.bind(this)}),this.$glow.addClass("oo-ui-toggleSwitchWidget-glow"),this.$grip.addClass("oo-ui-toggleSwitchWidget-grip"),this.$element.addClass("oo-ui-toggleSwitchWidget").attr("role","checkbox").append(this.$glow,this.$grip)},d.inheritClass(d.ui.ToggleSwitchWidget,d.ui.ToggleWidget),d.mixinClass(d.ui.ToggleSwitchWidget,d.ui.mixin.TabIndexedElement),d.ui.ToggleSwitchWidget.prototype.onClick=function(t){return this.isDisabled()||t.which!==d.ui.MouseButtons.LEFT||this.setValue(!this.value),!1},d.ui.ToggleSwitchWidget.prototype.onKeyPress=function(t){if(!this.isDisabled()&&(t.which===d.ui.Keys.SPACE||t.which===d.ui.Keys.ENTER))return this.setValue(!this.value),!1},d.ui.ToggleSwitchWidget.prototype.setValue=function(t){return d.ui.ToggleSwitchWidget.parent.prototype.setValue.call(this,t),this.$element.attr("aria-checked",this.value.toString()),this},d.ui.ToggleSwitchWidget.prototype.simulateLabelClick=function(){this.isDisabled()||this.setValue(!this.value),this.focus()},d.ui.OutlineControlsWidget=function(t,e){d.isPlainObject(t)&&void 0===e&&(t=(e=t).outline),e=e||{},d.ui.OutlineControlsWidget.parent.call(this,e),d.ui.mixin.GroupElement.call(this,e),this.outline=t,this.$movers=$("<div>"),this.upButton=new d.ui.ButtonWidget({framed:!1,icon:"collapse",title:d.ui.msg("ooui-outline-control-move-up")}),this.downButton=new d.ui.ButtonWidget({framed:!1,icon:"expand",title:d.ui.msg("ooui-outline-control-move-down")}),this.removeButton=new d.ui.ButtonWidget({framed:!1,icon:"trash",title:d.ui.msg("ooui-outline-control-remove")}),this.abilities={move:!0,remove:!0},t.connect(this,{select:"onOutlineChange",add:"onOutlineChange",remove:"onOutlineChange"}),this.upButton.connect(this,{click:["emit","move",-1]}),this.downButton.connect(this,{click:["emit","move",1]}),this.removeButton.connect(this,{click:["emit","remove"]}),this.$element.addClass("oo-ui-outlineControlsWidget"),this.$group.addClass("oo-ui-outlineControlsWidget-items"),this.$movers.addClass("oo-ui-outlineControlsWidget-movers").append(this.removeButton.$element,this.upButton.$element,this.downButton.$element),this.$element.append(this.$icon,this.$group,this.$movers),this.setAbilities(e.abilities||{})},d.inheritClass(d.ui.OutlineControlsWidget,d.ui.Widget),d.mixinClass(d.ui.OutlineControlsWidget,d.ui.mixin.GroupElement),d.ui.OutlineControlsWidget.prototype.setAbilities=function(t){var e;for(e in this.abilities)void 0!==t[e]&&(this.abilities[e]=!!t[e]);this.onOutlineChange()},d.ui.OutlineControlsWidget.prototype.onOutlineChange=function(){var t,e,i,n,s=this.outline.getItems(),o=this.outline.findSelectedItem(),u=this.abilities.move&&o&&o.isMovable(),l=this.abilities.remove&&o&&o.isRemovable();if(u){for(t=-1,e=s.length;++t<e;)if(s[t].isMovable()){i=s[t];break}for(t=e;t--;)if(s[t].isMovable()){n=s[t];break}}this.upButton.setDisabled(!u||o===i),this.downButton.setDisabled(!u||o===n),this.removeButton.setDisabled(!l)},d.ui.OutlineOptionWidget=function(t){t=t||{},d.ui.OutlineOptionWidget.parent.call(this,t),this.level=0,this.movable=!!t.movable,this.removable=!!t.removable,this.$element.addClass("oo-ui-outlineOptionWidget"),this.setLevel(t.level)},d.inheritClass(d.ui.OutlineOptionWidget,d.ui.DecoratedOptionWidget),d.ui.OutlineOptionWidget.static.highlightable=!0,d.ui.OutlineOptionWidget.static.scrollIntoViewOnSelect=!0,d.ui.OutlineOptionWidget.static.levelClass="oo-ui-outlineOptionWidget-level-",d.ui.OutlineOptionWidget.static.levels=3,d.ui.OutlineOptionWidget.prototype.isMovable=function(){return this.movable},d.ui.OutlineOptionWidget.prototype.isRemovable=function(){return this.removable},d.ui.OutlineOptionWidget.prototype.getLevel=function(){return this.level},d.ui.OutlineOptionWidget.prototype.setPressed=function(t){return d.ui.OutlineOptionWidget.parent.prototype.setPressed.call(this,t),this},d.ui.OutlineOptionWidget.prototype.setMovable=function(t){return this.movable=!!t,this.updateThemeClasses(),this},d.ui.OutlineOptionWidget.prototype.setRemovable=function(t){return this.removable=!!t,this.updateThemeClasses(),this},d.ui.OutlineOptionWidget.prototype.setSelected=function(t){return d.ui.OutlineOptionWidget.parent.prototype.setSelected.call(this,t),this},d.ui.OutlineOptionWidget.prototype.setLevel=function(t){var e=this.constructor.static.levels,i=this.constructor.static.levelClass,n=e;for(this.level=t?Math.max(0,Math.min(e-1,t)):0;n--;)this.level===n?this.$element.addClass(i+n):this.$element.removeClass(i+n);return this.updateThemeClasses(),this},d.ui.OutlineSelectWidget=function(t){d.ui.OutlineSelectWidget.parent.call(this,t),d.ui.mixin.TabIndexedElement.call(this,t),this.$element.on({focus:this.bindDocumentKeyDownListener.bind(this),blur:this.unbindDocumentKeyDownListener.bind(this)}),this.$element.addClass("oo-ui-outlineSelectWidget")},d.inheritClass(d.ui.OutlineSelectWidget,d.ui.SelectWidget),d.mixinClass(d.ui.OutlineSelectWidget,d.ui.mixin.TabIndexedElement),d.ui.ButtonOptionWidget=function(t){t=t||{},d.ui.ButtonOptionWidget.parent.call(this,t),d.ui.mixin.ButtonElement.call(this,t),d.ui.mixin.IconElement.call(this,t),d.ui.mixin.IndicatorElement.call(this,t),d.ui.mixin.TitledElement.call(this,$.extend({},t,{$titled:this.$button})),this.$element.addClass("oo-ui-buttonOptionWidget"),this.$button.append(this.$icon,this.$label,this.$indicator),this.$element.append(this.$button)},d.inheritClass(d.ui.ButtonOptionWidget,d.ui.OptionWidget),d.mixinClass(d.ui.ButtonOptionWidget,d.ui.mixin.ButtonElement),d.mixinClass(d.ui.ButtonOptionWidget,d.ui.mixin.IconElement),d.mixinClass(d.ui.ButtonOptionWidget,d.ui.mixin.IndicatorElement),d.mixinClass(d.ui.ButtonOptionWidget,d.ui.mixin.TitledElement),d.ui.ButtonOptionWidget.static.cancelButtonMouseDownEvents=!1,d.ui.ButtonOptionWidget.static.highlightable=!1,d.ui.ButtonOptionWidget.prototype.setSelected=function(t){return d.ui.ButtonOptionWidget.parent.prototype.setSelected.call(this,t),this.constructor.static.selectable&&this.setActive(t),this},d.ui.ButtonSelectWidget=function(t){d.ui.ButtonSelectWidget.parent.call(this,t),d.ui.mixin.TabIndexedElement.call(this,t),this.$element.on({focus:this.bindDocumentKeyDownListener.bind(this),blur:this.unbindDocumentKeyDownListener.bind(this)}),this.$element.addClass("oo-ui-buttonSelectWidget")},d.inheritClass(d.ui.ButtonSelectWidget,d.ui.SelectWidget),d.mixinClass(d.ui.ButtonSelectWidget,d.ui.mixin.TabIndexedElement),d.ui.TabOptionWidget=function(t){t=t||{},d.ui.TabOptionWidget.parent.call(this,t),this.$element.addClass("oo-ui-tabOptionWidget").attr("role","tab")},d.inheritClass(d.ui.TabOptionWidget,d.ui.OptionWidget),d.ui.TabOptionWidget.static.highlightable=!1,d.ui.TabSelectWidget=function(t){d.ui.TabSelectWidget.parent.call(this,t),d.ui.mixin.TabIndexedElement.call(this,t),this.$element.on({focus:this.bindDocumentKeyDownListener.bind(this),blur:this.unbindDocumentKeyDownListener.bind(this)}),this.$element.addClass("oo-ui-tabSelectWidget").attr("role","tablist")},d.inheritClass(d.ui.TabSelectWidget,d.ui.SelectWidget),d.mixinClass(d.ui.TabSelectWidget,d.ui.mixin.TabIndexedElement),d.ui.TagItemWidget=function(t){t=t||{},d.ui.TagItemWidget.parent.call(this,t),d.ui.mixin.ItemWidget.call(this),d.ui.mixin.LabelElement.call(this,t),d.ui.mixin.FlaggedElement.call(this,t),d.ui.mixin.TabIndexedElement.call(this,t),d.ui.mixin.DraggableElement.call(this,t),this.valid=void 0===t.valid||!!t.valid,this.fixed=!!t.fixed,this.closeButton=new d.ui.ButtonWidget({framed:!1,icon:"close",tabIndex:-1,title:d.ui.msg("ooui-item-remove")}),this.closeButton.setDisabled(this.isDisabled()),this.closeButton.connect(this,{click:"remove"}),this.$element.on("click",this.select.bind(this)).on("keydown",this.onKeyDown.bind(this)).on("mousedown",function(t){t.stopPropagation()}),this.$element.addClass("oo-ui-tagItemWidget").append(this.$label,this.closeButton.$element)},d.inheritClass(d.ui.TagItemWidget,d.ui.Widget),d.mixinClass(d.ui.TagItemWidget,d.ui.mixin.ItemWidget),d.mixinClass(d.ui.TagItemWidget,d.ui.mixin.LabelElement),d.mixinClass(d.ui.TagItemWidget,d.ui.mixin.FlaggedElement),d.mixinClass(d.ui.TagItemWidget,d.ui.mixin.TabIndexedElement),d.mixinClass(d.ui.TagItemWidget,d.ui.mixin.DraggableElement),d.ui.TagItemWidget.prototype.setFixed=function(t){return t=void 0===t?!this.fixed:!!t,this.fixed!==t&&(this.fixed=t,this.closeButton&&this.closeButton.toggle(!this.fixed),this.fixed||!this.elementGroup||this.elementGroup.isDraggable()||this.toggleDraggable(!this.fixed),this.$element.toggleClass("oo-ui-tagItemWidget-fixed",this.fixed),this.emit("fixed",this.isFixed())),this},d.ui.TagItemWidget.prototype.isFixed=function(){return this.fixed},d.ui.TagItemWidget.prototype.setDisabled=function(t){return t&&this.elementGroup&&!this.elementGroup.isDisabled()&&d.ui.warnDeprecation("TagItemWidget#setDisabled: Disabling individual items is deprecated and will result in inconsistent behavior. Use #setFixed instead. See T193571."),d.ui.TagItemWidget.parent.prototype.setDisabled.call(this,t),t||!this.toggleDraggable||!this.elementGroup||this.isFixed()||this.elementGroup.isDraggable()||this.toggleDraggable(!t),this.closeButton&&this.closeButton.setDisabled(t),this},d.ui.TagItemWidget.prototype.remove=function(){this.isDisabled()||this.isFixed()||this.emit("remove")},d.ui.TagItemWidget.prototype.onKeyDown=function(t){var e;return!this.isDisabled()&&!this.isFixed()&&t.keyCode===d.ui.Keys.BACKSPACE||t.keyCode===d.ui.Keys.DELETE?(this.remove(),!1):t.keyCode===d.ui.Keys.ENTER?(this.select(),!1):t.keyCode===d.ui.Keys.LEFT||t.keyCode===d.ui.Keys.RIGHT?(e="rtl"===d.ui.Element.static.getDir(this.$element)?{left:"forwards",right:"backwards"}:{left:"backwards",right:"forwards"},this.emit("navigate",t.keyCode===d.ui.Keys.LEFT?e.left:e.right),!1):void 0},d.ui.TagItemWidget.prototype.select=function(){this.isDisabled()||this.emit("select")},d.ui.TagItemWidget.prototype.toggleValid=function(t){t=void 0===t?!this.valid:!!t,this.valid!==t&&(this.valid=t,this.setFlags({invalid:!this.valid}),this.emit("valid",this.valid))},d.ui.TagItemWidget.prototype.isValid=function(){return this.valid},d.ui.TagMultiselectWidget=function(t){var e,i=window.requestAnimationFrame||setTimeout,n=this,s=$("<span>").addClass("oo-ui-tagMultiselectWidget-focusTrap");t=t||{},d.ui.TagMultiselectWidget.parent.call(this,t),d.ui.mixin.GroupWidget.call(this,t),d.ui.mixin.IndicatorElement.call(this,t),d.ui.mixin.IconElement.call(this,t),d.ui.mixin.TabIndexedElement.call(this,t),d.ui.mixin.FlaggedElement.call(this,t),d.ui.mixin.DraggableGroupElement.call(this,t),this.toggleDraggable(void 0===t.allowReordering||!!t.allowReordering),this.inputPosition=-1<this.constructor.static.allowedInputPositions.indexOf(t.inputPosition)?t.inputPosition:"inline",this.allowEditTags=void 0===t.allowEditTags||!!t.allowEditTags,this.allowArbitrary=!!t.allowArbitrary,this.allowDuplicates=!!t.allowDuplicates,this.allowedValues=t.allowedValues||[],this.allowDisplayInvalidTags=t.allowDisplayInvalidTags,this.hasInput="none"!==this.inputPosition,this.tagLimit=t.tagLimit,this.height=null,this.valid=!0,this.$content=$("<div>").addClass("oo-ui-tagMultiselectWidget-content"),this.$handle=$("<div>").addClass("oo-ui-tagMultiselectWidget-handle").append(this.$indicator,this.$icon,this.$content.append(this.$group.addClass("oo-ui-tagMultiselectWidget-group"))),this.aggregate({remove:"itemRemove",navigate:"itemNavigate",select:"itemSelect",fixed:"itemFixed"}),this.connect(this,{itemRemove:"onTagRemove",itemSelect:"onTagSelect",itemFixed:"onTagFixed",itemNavigate:"onTagNavigate",change:"onChangeTags"}),this.$handle.on({mousedown:this.onMouseDown.bind(this)}),this.$element.addClass("oo-ui-tagMultiselectWidget").append(this.$handle),this.hasInput?(t.inputWidget?this.input=t.inputWidget:this.input=new d.ui.TextInputWidget($.extend({placeholder:t.placeholder,classes:["oo-ui-tagMultiselectWidget-input"]},t.input)),this.input.setDisabled(this.isDisabled()),e={focus:this.onInputFocus.bind(this),blur:this.onInputBlur.bind(this),"propertychange change click mouseup keydown keyup input cut paste select focus":d.ui.debounce(this.updateInputSize.bind(this)),keydown:this.onInputKeyDown.bind(this),keypress:this.onInputKeyPress.bind(this)},this.input.$input.on(e),this.inputPlaceholder=this.input.$input.attr("placeholder"),"outline"===this.inputPosition?(this.input.$element.css("max-width","inherit"),this.$element.addClass("oo-ui-tagMultiselectWidget-outlined").append(this.input.$element)):(this.$element.addClass("oo-ui-tagMultiselectWidget-inlined"),this.$content.append(this.input.$input))):this.$content.append(s),this.setTabIndexedElement(this.hasInput?this.input.$input:s),t.selected&&this.setValue(t.selected),i(function(){n.hasInput&&n.updateInputSize()})},d.inheritClass(d.ui.TagMultiselectWidget,d.ui.Widget),d.mixinClass(d.ui.TagMultiselectWidget,d.ui.mixin.GroupWidget),d.mixinClass(d.ui.TagMultiselectWidget,d.ui.mixin.DraggableGroupElement),d.mixinClass(d.ui.TagMultiselectWidget,d.ui.mixin.IndicatorElement),d.mixinClass(d.ui.TagMultiselectWidget,d.ui.mixin.IconElement),d.mixinClass(d.ui.TagMultiselectWidget,d.ui.mixin.TabIndexedElement),d.mixinClass(d.ui.TagMultiselectWidget,d.ui.mixin.FlaggedElement),d.ui.TagMultiselectWidget.static.allowedInputPositions=["inline","outline","none"],d.ui.TagMultiselectWidget.prototype.onMouseDown=function(t){if(!(this.isDisabled()||this.hasInput&&t.target===this.input.$input[0]||t.which!==d.ui.MouseButtons.LEFT))return this.focus(),!1},d.ui.TagMultiselectWidget.prototype.onInputKeyPress=function(t){var e,i=t.metaKey||t.ctrlKey;if(!this.isDisabled())return t.which===d.ui.Keys.ENTER&&(e=this.doInputEnter(t,i)),setTimeout(this.updateInputSize.bind(this),0),e},d.ui.TagMultiselectWidget.prototype.onInputKeyDown=function(t){var e,i,n,s,o,u=this,l=t.metaKey||t.ctrlKey;if(!this.isDisabled()){if(t.keyCode===d.ui.Keys.BACKSPACE)return this.doInputBackspace(t,l);if(t.keyCode===d.ui.Keys.ESCAPE)return this.doInputEscape(t);if((t.keyCode===d.ui.Keys.LEFT||t.keyCode===d.ui.Keys.RIGHT)&&(e="rtl"===d.ui.Element.static.getDir(this.$element)?{left:"forwards",right:"backwards"}:{left:"backwards",right:"forwards"},i=t.keyCode===d.ui.Keys.LEFT?e.left:e.right,!this.hasInput||(n=i,s=u.input.getRange(),o=u.hasInput&&u.input.getValue(),"forwards"===n&&s.to>o.length-1||"backwards"===n&&s.from<=0)))return this.doInputArrow(t,i,l)}},d.ui.TagMultiselectWidget.prototype.onInputFocus=function(){this.$element.addClass("oo-ui-tagMultiselectWidget-focus"),this.toggleValid(!0)},d.ui.TagMultiselectWidget.prototype.onInputBlur=function(){this.$element.removeClass("oo-ui-tagMultiselectWidget-focus"),this.addTagFromInput(),this.toggleValid(this.checkValidity()&&(!this.hasInput||!this.input.getValue()))},d.ui.TagMultiselectWidget.prototype.doInputEnter=function(){return this.addTagFromInput(),!1},d.ui.TagMultiselectWidget.prototype.doInputBackspace=function(t,e){var i,n;if("inline"===this.inputPosition&&""===this.input.getValue()&&!this.isEmpty())return(n=(i=this.getItems())[i.length-1]).isDisabled()||n.isFixed()||(this.removeItems([n]),e||this.input.setValue(n.getData())),!1},d.ui.TagMultiselectWidget.prototype.doInputEscape=function(){this.clearInput()},d.ui.TagMultiselectWidget.prototype.doInputArrow=function(t,e){"inline"!==this.inputPosition||this.isEmpty()||"backwards"!==e||this.getPreviousItem().focus()},d.ui.TagMultiselectWidget.prototype.onTagSelect=function(t){this.hasInput&&this.allowEditTags&&!t.isFixed()&&(this.input.getValue()&&this.addTagFromInput(),this.input.setValue(t.getData()),this.removeItems([t]),this.focus())},d.ui.TagMultiselectWidget.prototype.onTagFixed=function(t){var e,i=this.getItems();for(e=0;e<i.length&&(i[e]===t||i[e].isFixed());e++);this.addItems(t,e)},d.ui.TagMultiselectWidget.prototype.onChangeTags=function(){var t=this.isUnderLimit();this.toggleValid(this.checkValidity()&&!(this.hasInput&&this.input.getValue())),this.hasInput&&(this.updateInputSize(),t||this.input.setValue(""),"outline"===this.inputPosition?(this.input.$input.attr("placeholder",t?this.inputPlaceholder:""),this.input.setDisabled(!t)):this.input.$input.toggleClass("oo-ui-element-hidden",!t)),this.updateIfHeightChanged()},d.ui.TagMultiselectWidget.prototype.setDisabled=function(e){d.ui.TagMultiselectWidget.parent.prototype.setDisabled.call(this,e),this.hasInput&&this.input&&this.input.setDisabled(!!e&&!this.isUnderLimit()),this.items&&this.getItems().forEach(function(t){t.setDisabled(!!e)})},d.ui.TagMultiselectWidget.prototype.onTagRemove=function(t){this.removeTagByData(t.getData())},d.ui.TagMultiselectWidget.prototype.onTagNavigate=function(t,e){var i=this.getItems()[0];"forwards"===e?this.getNextItem(t).focus():"inline"!==!this.inputPosition&&t===i||this.getPreviousItem(t).focus()},d.ui.TagMultiselectWidget.prototype.addTagFromInput=function(){var t=this.input.getValue(),e=this.isAllowedData(t);t&&(e||this.allowDisplayInvalidTags)&&(this.clearInput(),this.addTag(t))},d.ui.TagMultiselectWidget.prototype.clearInput=function(){this.input.setValue("")},d.ui.TagMultiselectWidget.prototype.isDuplicateData=function(t){return!!this.findItemFromData(t)},d.ui.TagMultiselectWidget.prototype.isAllowedData=function(e){return!(!this.allowDuplicates&&this.isDuplicateData(e))&&(!!this.allowArbitrary||!!this.getAllowedValues().some(function(t){return e===t}))},d.ui.TagMultiselectWidget.prototype.getAllowedValues=function(){return this.allowedValues},d.ui.TagMultiselectWidget.prototype.addAllowedValue=function(t){-1===this.allowedValues.indexOf(t)&&this.allowedValues.push(t)},d.ui.TagMultiselectWidget.prototype.getValue=function(){return this.getItems().filter(function(t){return t.isValid()}).map(function(t){return t.getData()})},d.ui.TagMultiselectWidget.prototype.setValue=function(t){t=Array.isArray(t)?t:[t],this.clearItems(),t.forEach(function(t){"string"==typeof t?this.addTag(t):this.addTag(t.data,t.label)}.bind(this))},d.ui.TagMultiselectWidget.prototype.addTag=function(t,e){var i,n=this.isAllowedData(t);return!(!this.isUnderLimit()||!n&&!this.allowDisplayInvalidTags)&&((i=this.createTagItemWidget(t,e)).toggleValid(n),this.addItems([i]),!0)},d.ui.TagMultiselectWidget.prototype.isUnderLimit=function(){return!this.tagLimit||this.getItemCount()<this.tagLimit},d.ui.TagMultiselectWidget.prototype.removeTagByData=function(t){var e=this.findItemFromData(t);this.removeItems([e])},d.ui.TagMultiselectWidget.prototype.createTagItemWidget=function(t,e){return e=e||t,new d.ui.TagItemWidget({data:t,label:e})},d.ui.TagMultiselectWidget.prototype.getNextItem=function(t){var e=this.items.indexOf(t);return void 0===t||-1===e?this.items[0]:e===this.items.length-1?this.hasInput?this.input:this.items[0]:this.items[e+1]},d.ui.TagMultiselectWidget.prototype.getPreviousItem=function(t){var e=this.items.indexOf(t);return void 0===t||-1===e?this.items[this.items.length-1]:0===e?this.hasInput?this.input:this.items[this.items.length-1]:this.items[e-1]},d.ui.TagMultiselectWidget.prototype.updateInputSize=function(){var t,e,i,n;if("inline"!==this.inputPosition||this.isDisabled())this.updateIfHeightChanged();else{if(0===this.input.$input[0].scrollWidth)return;if(this.input.$input.css("width","1em"),t=this.$group.children().last(),e=d.ui.Element.static.getDir(this.$handle),void 0===this.contentWidthWithPlaceholder&&""===this.input.getValue()&&void 0!==this.input.$input.attr("placeholder")&&(this.input.setValue(this.input.$input.attr("placeholder")),this.contentWidthWithPlaceholder=this.input.$input[0].scrollWidth,this.input.setValue("")),(i=Math.max(this.input.$input[0].scrollWidth,void 0===this.contentWidthWithPlaceholder?0:this.contentWidthWithPlaceholder))<this.input.$input.width())return void this.updateIfHeightChanged();n=0===t.length?this.$content.innerWidth():"ltr"===e?this.$content.innerWidth()-t.position().left-t.outerWidth():t.position().left,(n-=13)<i&&(n=this.$content.innerWidth()-13),this.input.$input.width(Math.floor(n)),this.updateIfHeightChanged()}},d.ui.TagMultiselectWidget.prototype.updateIfHeightChanged=function(){var t=this.$element.height();t!==this.height&&(this.height=t,this.emit("resize"))},d.ui.TagMultiselectWidget.prototype.checkValidity=function(){return this.getItems().every(function(t){return t.isValid()})},d.ui.TagMultiselectWidget.prototype.toggleValid=function(t){t=void 0===t?!this.valid:!!t,this.valid!==t&&(this.valid=t,this.setFlags({invalid:!this.valid}),this.emit("valid",this.valid))},d.ui.TagMultiselectWidget.prototype.isValid=function(){return this.valid},d.ui.PopupTagMultiselectWidget=function(t){var e,i={popup:{}};t=t||{},d.ui.PopupTagMultiselectWidget.parent.call(this,$.extend({inputPosition:"none"},t)),this.$overlay=(!0===t.$overlay?d.ui.getDefaultOverlay():t.$overlay)||this.$element,t.popup||(e=new d.ui.TextInputWidget,i.popupInput=e,i.popup.$content=e.$element,i.popup.padded=!0,this.$element.addClass("oo-ui-popupTagMultiselectWidget-defaultPopup")),i.popup.$overlay=this.$overlay,i.popup.$autoCloseIgnore=this.hasInput?this.input.$element.add(this.$overlay):this.$overlay,t=$.extend(i,t),d.ui.mixin.PopupElement.call(this,t),this.hasInput&&this.input.$input.on("focus",this.popup.toggle.bind(this.popup,!0)),this.popupInput=t.popupInput,this.popupInput&&this.popupInput.connect(this,{enter:"onPopupInputEnter"}),this.on("resize",this.popup.updateDimensions.bind(this.popup)),this.popup.connect(this,{toggle:"onPopupToggle"}),this.$tabIndexed.on("focus",this.onFocus.bind(this)),this.$element.append(this.popup.$element).addClass("oo-ui-popupTagMultiselectWidget")},d.inheritClass(d.ui.PopupTagMultiselectWidget,d.ui.TagMultiselectWidget),d.mixinClass(d.ui.PopupTagMultiselectWidget,d.ui.mixin.PopupElement),d.ui.PopupTagMultiselectWidget.prototype.onFocus=function(){this.popup.toggle(!0)},d.ui.PopupTagMultiselectWidget.prototype.onPopupToggle=function(t){t&&this.popupInput&&this.popupInput.focus()},d.ui.PopupTagMultiselectWidget.prototype.onPopupInputEnter=function(){this.popupInput&&(this.addTagByPopupValue(this.popupInput.getValue()),this.popupInput.setValue(""))},d.ui.PopupTagMultiselectWidget.prototype.onTagSelect=function(t){this.popupInput&&this.allowEditTags?(this.popupInput.setValue(t.getData()),this.removeItems([t]),this.popup.toggle(!0),this.popupInput.focus()):d.ui.PopupTagMultiselectWidget.parent.prototype.onTagSelect.call(this,t)},d.ui.PopupTagMultiselectWidget.prototype.addTagByPopupValue=function(t,e){this.addTag(t,e)},d.ui.MenuTagMultiselectWidget=function(t){t=t||{},d.ui.MenuTagMultiselectWidget.parent.call(this,t),this.$overlay=(!0===t.$overlay?d.ui.getDefaultOverlay():t.$overlay)||this.$element,this.clearInputOnChoose=void 0===t.clearInputOnChoose||!!t.clearInputOnChoose,this.menu=this.createMenuWidget($.extend({widget:this,input:this.hasInput?this.input:null,$input:this.hasInput?this.input.$input:null,filterFromInput:!!this.hasInput,$autoCloseIgnore:this.hasInput?this.input.$element:$([]),$floatableContainer:this.hasInput&&"outline"===this.inputPosition?this.input.$element:this.$element,$overlay:this.$overlay,disabled:this.isDisabled()},t.menu)),this.addOptions(t.options||[]),this.menu.connect(this,{choose:"onMenuChoose",toggle:"onMenuToggle"}),this.hasInput&&this.input.connect(this,{change:"onInputChange"}),this.connect(this,{resize:"onResize"}),this.$overlay.append(this.menu.$element),this.$element.addClass("oo-ui-menuTagMultiselectWidget"),t.selected&&this.setValue(t.selected)},d.inheritClass(d.ui.MenuTagMultiselectWidget,d.ui.TagMultiselectWidget),d.ui.MenuTagMultiselectWidget.prototype.onResize=function(){this.menu.position()},d.ui.MenuTagMultiselectWidget.prototype.onInputFocus=function(){d.ui.MenuTagMultiselectWidget.parent.prototype.onInputFocus.call(this),this.menu.toggle(!0)},d.ui.MenuTagMultiselectWidget.prototype.onInputBlur=function(){d.ui.MenuTagMultiselectWidget.parent.prototype.onInputBlur.call(this),this.menu.toggle(!1)},d.ui.MenuTagMultiselectWidget.prototype.onInputChange=function(){this.menu.toggle(!0),this.initializeMenuSelection()},d.ui.MenuTagMultiselectWidget.prototype.onMenuChoose=function(t){this.addTag(t.getData(),t.getLabel()),this.hasInput&&this.clearInputOnChoose&&this.input.setValue("")},d.ui.MenuTagMultiselectWidget.prototype.onMenuToggle=function(t){t?this.initializeMenuSelection():(this.menu.selectItem(null),this.menu.highlightItem(null))},d.ui.MenuTagMultiselectWidget.prototype.onTagSelect=function(t){var e=this.menu.findItemFromData(t.getData());this.allowArbitrary?d.ui.MenuTagMultiselectWidget.parent.prototype.onTagSelect.call(this,t):(this.hasInput&&this.menu.filterFromInput&&this.input.setValue(""),this.menu.selectItem(e),this.focus())},d.ui.MenuTagMultiselectWidget.prototype.setDisabled=function(t){d.ui.MenuTagMultiselectWidget.parent.prototype.setDisabled.call(this,t),this.menu&&this.menu.setDisabled(t)},d.ui.MenuTagMultiselectWidget.prototype.initializeMenuSelection=function(){this.menu.findSelectedItem()||this.menu.highlightItem(this.menu.findFirstSelectableItem())},d.ui.MenuTagMultiselectWidget.prototype.addTagFromInput=function(){var t=this.input.getValue(),e=this.menu.findHighlightedItem()||this.menu.findItemFromData(t),i=e?e.getData():t,n=this.isAllowedData(i);t&&(n||this.allowDisplayInvalidTags)&&(this.clearInput(),e?this.addTag(i,e.getLabel()):this.addTag(t))},d.ui.MenuTagMultiselectWidget.prototype.getMenuVisibleItems=function(){return this.menu.getItems().filter(function(t){return t.isVisible()})},d.ui.MenuTagMultiselectWidget.prototype.createMenuWidget=function(t){return new d.ui.MenuSelectWidget(t)},d.ui.MenuTagMultiselectWidget.prototype.addOptions=function(t){var e=this,i=t.map(function(t){return e.createMenuOptionWidget(t.data,t.label,t.icon)});this.menu.addItems(i)},d.ui.MenuTagMultiselectWidget.prototype.createMenuOptionWidget=function(t,e,i){return new d.ui.MenuOptionWidget({data:t,label:e||t,icon:i})},d.ui.MenuTagMultiselectWidget.prototype.getMenu=function(){return this.menu},d.ui.MenuTagMultiselectWidget.prototype.getAllowedValues=function(){var t=[];return this.menu&&(t=this.menu.getItems().map(function(t){return t.getData()})),this.allowedValues.concat(t)},d.ui.SelectFileWidget=function(t){var e;t=$.extend({accept:null,placeholder:d.ui.msg("ooui-selectfile-placeholder"),notsupported:d.ui.msg("ooui-selectfile-not-supported"),droppable:!0,showDropTarget:!1,thumbnailSizeLimit:20},t),d.ui.SelectFileWidget.parent.call(this,t),d.ui.mixin.IconElement.call(this,t),d.ui.mixin.IndicatorElement.call(this,t),d.ui.mixin.PendingElement.call(this,$.extend({},t,{$pending:this.$info})),d.ui.mixin.LabelElement.call(this,t),this.$info=$("<span>"),this.showDropTarget=t.showDropTarget,this.thumbnailSizeLimit=t.thumbnailSizeLimit,this.isSupported=this.constructor.static.isSupported(),this.currentFile=null,Array.isArray(t.accept)?this.accept=t.accept:this.accept=null,this.placeholder=t.placeholder,this.notsupported=t.notsupported,this.onFileSelectedHandler=this.onFileSelected.bind(this),this.selectButton=new d.ui.ButtonWidget({$element:$("<label>"),classes:["oo-ui-selectFileWidget-selectButton"],label:d.ui.msg("ooui-selectfile-button-select"),disabled:this.disabled||!this.isSupported}),this.clearButton=new d.ui.ButtonWidget({classes:["oo-ui-selectFileWidget-clearButton"],framed:!1,icon:"close",disabled:this.disabled}),this.selectButton.$button.on({keypress:this.onKeyPress.bind(this)}),this.clearButton.connect(this,{click:"onClearClick"}),t.droppable&&(e=this.onDragEnterOrOver.bind(this),this.$element.on({dragenter:e,dragover:e,dragleave:this.onDragLeave.bind(this),drop:this.onDrop.bind(this)})),this.addInput(),this.$label.addClass("oo-ui-selectFileWidget-label"),this.$info.addClass("oo-ui-selectFileWidget-info").append(this.$icon,this.$label,this.clearButton.$element,this.$indicator),t.droppable&&t.showDropTarget?(this.selectButton.setIcon("upload"),this.$thumbnail=$("<div>").addClass("oo-ui-selectFileWidget-thumbnail"),this.setPendingElement(this.$thumbnail),this.$element.addClass("oo-ui-selectFileWidget-dropTarget oo-ui-selectFileWidget").on({click:this.onDropTargetClick.bind(this)}).append(this.$thumbnail,this.$info,this.selectButton.$element,$("<span>").addClass("oo-ui-selectFileWidget-dropLabel").text(d.ui.msg("ooui-selectfile-dragdrop-placeholder")))):this.$element.addClass("oo-ui-selectFileWidget").append(this.$info,this.selectButton.$element),this.updateUI()},d.inheritClass(d.ui.SelectFileWidget,d.ui.Widget),d.mixinClass(d.ui.SelectFileWidget,d.ui.mixin.IconElement),d.mixinClass(d.ui.SelectFileWidget,d.ui.mixin.IndicatorElement),d.mixinClass(d.ui.SelectFileWidget,d.ui.mixin.PendingElement),d.mixinClass(d.ui.SelectFileWidget,d.ui.mixin.LabelElement),d.ui.SelectFileWidget.static.isSupported=function(){var t;return null===d.ui.SelectFileWidget.static.isSupportedCache&&(t=$("<input>").attr("type","file"),d.ui.SelectFileWidget.static.isSupportedCache=void 0!==t[0].files),d.ui.SelectFileWidget.static.isSupportedCache},d.ui.SelectFileWidget.static.isSupportedCache=null,d.ui.SelectFileWidget.prototype.getValue=function(){return this.currentFile},d.ui.SelectFileWidget.prototype.setValue=function(t){this.currentFile!==t&&(this.currentFile=t,this.updateUI(),this.emit("change",this.currentFile))},d.ui.SelectFileWidget.prototype.focus=function(){return this.selectButton.focus(),this},d.ui.SelectFileWidget.prototype.blur=function(){return this.selectButton.blur(),this},d.ui.SelectFileWidget.prototype.simulateLabelClick=function(){this.focus()},d.ui.SelectFileWidget.prototype.updateUI=function(){var t;this.isSupported?(this.$element.addClass("oo-ui-selectFileWidget-supported"),this.currentFile?(this.$element.removeClass("oo-ui-selectFileWidget-empty"),t=(t=$([])).add($("<span>").addClass("oo-ui-selectFileWidget-fileName").text(this.currentFile.name)),this.setLabel(t),this.showDropTarget&&(this.pushPending(),this.loadAndGetImageUrl().done(function(t){this.$thumbnail.css("background-image","url( "+t+" )")}.bind(this)).fail(function(){this.$thumbnail.append(new d.ui.IconWidget({icon:"attachment",classes:["oo-ui-selectFileWidget-noThumbnail-icon"]}).$element)}.bind(this)).always(function(){this.popPending()}.bind(this)),this.$element.off("click"))):(this.showDropTarget&&(this.$element.off("click"),this.$element.on({click:this.onDropTargetClick.bind(this)}),this.$thumbnail.empty().css("background-image","")),this.$element.addClass("oo-ui-selectFileWidget-empty"),this.setLabel(this.placeholder))):(this.$element.addClass("oo-ui-selectFileWidget-notsupported"),this.$element.removeClass("oo-ui-selectFileWidget-empty"),this.setLabel(this.notsupported))},d.ui.SelectFileWidget.prototype.loadAndGetImageUrl=function(){var i=$.Deferred(),t=this.currentFile,e=new FileReader;return t&&0===(d.getProp(t,"type")||"").indexOf("image/")&&t.size<1024*this.thumbnailSizeLimit*1024?(e.onload=function(t){var e=document.createElement("img");e.addEventListener("load",function(){0===e.naturalWidth||0===e.naturalHeight||!1===e.complete?i.reject():i.resolve(t.target.result)}),e.src=t.target.result},e.readAsDataURL(t)):i.reject(),i.promise()},d.ui.SelectFileWidget.prototype.addInput=function(){this.$input&&this.$input.remove(),this.isSupported?(this.$input=$("<input>").attr("type","file"),this.$input.on("change",this.onFileSelectedHandler),this.$input.on("click",function(t){t.stopPropagation()}),this.$input.attr({tabindex:-1}),this.accept&&this.$input.attr("accept",this.accept.join(", ")),this.selectButton.$button.append(this.$input)):this.$input=null},d.ui.SelectFileWidget.prototype.isAllowedType=function(t){var e,i;if(!this.accept||!t)return!0;for(e=0;e<this.accept.length;e++){if((i=this.accept[e])===t)return!0;if("/*"===i.substr(-2)&&(i=i.substr(0,i.length-1),t.substr(0,i.length)===i))return!0}return!1},d.ui.SelectFileWidget.prototype.onFileSelected=function(t){var e=d.getProp(t.target,"files",0)||null;e&&!this.isAllowedType(e.type)&&(e=null),this.setValue(e),this.addInput()},d.ui.SelectFileWidget.prototype.onClearClick=function(){return this.setValue(null),!1},d.ui.SelectFileWidget.prototype.onKeyPress=function(t){if(this.isSupported&&!this.isDisabled()&&this.$input&&(t.which===d.ui.Keys.SPACE||t.which===d.ui.Keys.ENTER))return this.$input.click(),!1},d.ui.SelectFileWidget.prototype.onDropTargetClick=function(){if(this.isSupported&&!this.isDisabled()&&this.$input)return this.$input.click(),!1},d.ui.SelectFileWidget.prototype.onDragEnterOrOver=function(t){var e,i=!1,n=t.originalEvent.dataTransfer;return t.preventDefault(),t.stopPropagation(),this.isDisabled()||!this.isSupported?(this.$element.removeClass("oo-ui-selectFileWidget-canDrop"),!(n.dropEffect="none")):((e=d.getProp(n,"items",0)||d.getProp(n,"files",0))?this.isAllowedType(e.type)&&(i=!0):-1!==Array.prototype.indexOf.call(d.getProp(n,"types")||[],"Files")&&(i=!0),this.$element.toggleClass("oo-ui-selectFileWidget-canDrop",i),i||(n.dropEffect="none"),!1)},d.ui.SelectFileWidget.prototype.onDragLeave=function(){this.$element.removeClass("oo-ui-selectFileWidget-canDrop")},d.ui.SelectFileWidget.prototype.onDrop=function(t){var e=null,i=t.originalEvent.dataTransfer;return t.preventDefault(),t.stopPropagation(),this.$element.removeClass("oo-ui-selectFileWidget-canDrop"),this.isDisabled()||!this.isSupported||((e=d.getProp(i,"files",0))&&!this.isAllowedType(e.type)&&(e=null),e&&this.setValue(e)),!1},d.ui.SelectFileWidget.prototype.setDisabled=function(t){return d.ui.SelectFileWidget.parent.prototype.setDisabled.call(this,t),this.selectButton&&this.selectButton.setDisabled(t),this.clearButton&&this.clearButton.setDisabled(t),this},d.ui.SearchWidget=function(t){t=t||{},d.ui.SearchWidget.parent.call(this,t),this.query=new d.ui.TextInputWidget({icon:"search",placeholder:t.placeholder,value:t.value}),this.results=new d.ui.SelectWidget,this.$query=$("<div>"),this.$results=$("<div>"),this.query.connect(this,{change:"onQueryChange",enter:"onQueryEnter"}),this.query.$input.on("keydown",this.onQueryKeydown.bind(this)),this.$query.addClass("oo-ui-searchWidget-query").append(this.query.$element),this.$results.addClass("oo-ui-searchWidget-results").append(this.results.$element),this.$element.addClass("oo-ui-searchWidget").append(this.$results,this.$query)},d.inheritClass(d.ui.SearchWidget,d.ui.Widget),d.ui.SearchWidget.prototype.onQueryKeydown=function(t){var e,i,n=t.which===d.ui.Keys.DOWN?1:t.which===d.ui.Keys.UP?-1:0;n&&((e=this.results.findHighlightedItem())||(e=this.results.findSelectedItem()),i=this.results.findRelativeSelectableItem(e,n),this.results.highlightItem(i),i.scrollElementIntoView())},d.ui.SearchWidget.prototype.onQueryChange=function(){this.results.clearItems()},d.ui.SearchWidget.prototype.onQueryEnter=function(){var t=this.results.findHighlightedItem();t&&this.results.chooseItem(t)},d.ui.SearchWidget.prototype.getQuery=function(){return this.query},d.ui.SearchWidget.prototype.getResults=function(){return this.results}}(OO);
//# sourceMappingURL=oojs-ui-widgets.min.js.map